<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç≥ Cookstagram Recipe Browser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .recipe-card {
            animation: fadeIn 0.3s ease-out;
        }

        .tag {
            @apply inline-block px-2 py-1 text-xs rounded-full mr-1 mb-1 transition-all hover:scale-105;
        }

        .tag-protein { @apply bg-red-100 text-red-800 hover:bg-red-200; }
        .tag-vegetable { @apply bg-green-100 text-green-800 hover:bg-green-200; }
        .tag-method { @apply bg-blue-100 text-blue-800 hover:bg-blue-200; }
        .tag-equipment { @apply bg-purple-100 text-purple-800 hover:bg-purple-200; }
        .tag-occasion { @apply bg-yellow-100 text-yellow-800 hover:bg-yellow-200; }
        .tag-season { @apply bg-orange-100 text-orange-800 hover:bg-orange-200; }
        .tag-cuisine { @apply bg-pink-100 text-pink-800 hover:bg-pink-200; }
        .tag-difficulty { @apply bg-gray-100 text-gray-800 hover:bg-gray-200; }

        .filter-active {
            @apply bg-blue-600 text-white shadow-lg;
        }

        /* Custom scrollbar */
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üç≥ Cookstagram</h1>
            <p class="text-gray-600">Your Instagram recipe collection, organized and searchable</p>
        </div>

        <!-- Stats Bar -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold text-blue-600" id="total-recipes">0</div>
                    <div class="text-sm text-gray-600">Total Recipes</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-green-600" id="showing-recipes">0</div>
                    <div class="text-sm text-gray-600">Showing</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-purple-600" id="unique-ingredients">0</div>
                    <div class="text-sm text-gray-600">Ingredients</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-orange-600" id="avg-confidence">0%</div>
                    <div class="text-sm text-gray-600">Avg Confidence</div>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <!-- Search Bar -->
            <div class="mb-4">
                <input
                    type="text"
                    id="search-input"
                    placeholder="Search recipes by title, ingredients, or description..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
            </div>

            <!-- Quick Filters -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Filter Categories -->
                <div>
                    <h3 class="font-semibold text-gray-700 mb-2">ü•ó Cuisine & Diet</h3>
                    <div id="cuisine-filters" class="space-y-1"></div>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-700 mb-2">üë©‚Äçüç≥ Cooking</h3>
                    <div id="cooking-filters" class="space-y-1"></div>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-700 mb-2">üïí Time & Occasion</h3>
                    <div id="occasion-filters" class="space-y-1"></div>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div id="active-filters" class="mt-4 hidden">
                <div class="flex items-center gap-2 flex-wrap">
                    <span class="text-sm font-medium text-gray-700">Active filters:</span>
                    <div id="active-filter-tags" class="flex flex-wrap gap-1"></div>
                    <button id="clear-filters" class="text-sm text-blue-600 hover:text-blue-800 underline">Clear all</button>
                </div>
            </div>
        </div>

        <!-- Recipe Grid -->
        <div id="recipe-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Recipe cards will be inserted here -->
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="text-center py-12 hidden">
            <div class="text-6xl mb-4">üîç</div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">No recipes found</h3>
            <p class="text-gray-600">Try adjusting your search or filters</p>
        </div>

        <!-- Loading State -->
        <div id="loading" class="text-center py-12">
            <div class="text-6xl mb-4">üç≥</div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">Loading recipes...</h3>
            <p class="text-gray-600">Getting your delicious collection ready</p>
        </div>
    </div>

    <script>
        // Global state
        let recipes = [];
        let filteredRecipes = [];
        let activeFilters = new Set();

        // Initialize the app
        async function init() {
            try {
                // Try to load from local file first
                await loadRecipes();
                renderFilters();
                renderRecipes();
                updateStats();
            } catch (error) {
                console.error('Error loading recipes:', error);
                showError();
            }
        }

        // Load recipes data
        async function loadRecipes() {
            try {
                const response = await fetch('./analyzed_recipes.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                recipes = await response.json();
                console.log(`Loaded ${recipes.length} recipes successfully!`);
            } catch (error) {
                console.error('Error loading recipes:', error);
                // Fallback to sample data if file not found
                console.log('Using sample data instead...');
                recipes = [];
            }
            filteredRecipes = [...recipes];

            document.getElementById('loading').classList.add('hidden');
        }

        // Render filter buttons
        function renderFilters() {
            const cuisineContainer = document.getElementById('cuisine-filters');
            const cookingContainer = document.getElementById('cooking-filters');
            const occasionContainer = document.getElementById('occasion-filters');

            // Extract unique values for filters
            const cuisines = new Set();
            const dietary = new Set();
            const methods = new Set();
            const equipment = new Set();
            const occasions = new Set();
            const difficulties = new Set();

            recipes.forEach(recipe => {
                if (recipe.cuisine_type) cuisines.add(recipe.cuisine_type);
                if (recipe.dietary_tags) recipe.dietary_tags.forEach(tag => dietary.add(tag));
                if (recipe.cooking_method) recipe.cooking_method.forEach(method => methods.add(method));
                if (recipe.equipment) recipe.equipment.forEach(eq => equipment.add(eq));
                if (recipe.occasion_tags) recipe.occasion_tags.forEach(occ => occasions.add(occ));
                if (recipe.difficulty) difficulties.add(recipe.difficulty);
            });

            // Render cuisine and dietary filters
            cuisineContainer.innerHTML = '';
            [...cuisines].sort().forEach(cuisine => {
                cuisineContainer.appendChild(createFilterButton(cuisine, 'cuisine', 'üåç'));
            });
            [...dietary].sort().forEach(diet => {
                cuisineContainer.appendChild(createFilterButton(diet, 'dietary', 'ü•¨'));
            });

            // Render cooking filters
            cookingContainer.innerHTML = '';
            [...methods].sort().forEach(method => {
                cookingContainer.appendChild(createFilterButton(method, 'method', 'üî•'));
            });
            [...equipment].sort().forEach(eq => {
                cookingContainer.appendChild(createFilterButton(eq, 'equipment', 'üîß'));
            });
            [...difficulties].sort().forEach(diff => {
                cookingContainer.appendChild(createFilterButton(diff, 'difficulty', '‚≠ê'));
            });

            // Render occasion filters
            occasionContainer.innerHTML = '';
            [...occasions].sort().forEach(occasion => {
                occasionContainer.appendChild(createFilterButton(occasion, 'occasion', 'üïí'));
            });
        }

        // Create filter button
        function createFilterButton(value, type, emoji) {
            const button = document.createElement('button');
            button.className = 'px-3 py-1 text-sm rounded-full border border-gray-300 hover:bg-gray-50 transition-all';
            button.innerHTML = `${emoji} ${value.replace(/_/g, ' ')}`;
            button.onclick = () => toggleFilter(value, type, button);
            return button;
        }

        // Toggle filter
        function toggleFilter(value, type, button) {
            const filterKey = `${type}:${value}`;

            if (activeFilters.has(filterKey)) {
                activeFilters.delete(filterKey);
                button.classList.remove('filter-active');
            } else {
                activeFilters.add(filterKey);
                button.classList.add('filter-active');
            }

            applyFilters();
            updateActiveFiltersDisplay();
        }

        // Apply all filters
        function applyFilters() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();

            filteredRecipes = recipes.filter(recipe => {
                // Text search
                if (searchTerm) {
                    const searchable = [
                        recipe.title,
                        ...(recipe.ingredients || []),
                        ...(recipe.proteins || []),
                        ...(recipe.vegetables || []),
                        ...(recipe.key_ingredients || [])
                    ].join(' ').toLowerCase();

                    if (!searchable.includes(searchTerm)) return false;
                }

                // Tag filters
                for (const filterKey of activeFilters) {
                    const [type, value] = filterKey.split(':');

                    switch (type) {
                        case 'cuisine':
                            if (recipe.cuisine_type !== value) return false;
                            break;
                        case 'dietary':
                            if (!recipe.dietary_tags?.includes(value)) return false;
                            break;
                        case 'method':
                            if (!recipe.cooking_method?.includes(value)) return false;
                            break;
                        case 'equipment':
                            if (!recipe.equipment?.includes(value)) return false;
                            break;
                        case 'occasion':
                            if (!recipe.occasion_tags?.includes(value)) return false;
                            break;
                        case 'difficulty':
                            if (recipe.difficulty !== value) return false;
                            break;
                    }
                }

                return true;
            });

            renderRecipes();
            updateStats();
        }

        // Render recipe cards
        function renderRecipes() {
            const grid = document.getElementById('recipe-grid');
            const noResults = document.getElementById('no-results');

            if (filteredRecipes.length === 0) {
                grid.classList.add('hidden');
                noResults.classList.remove('hidden');
                return;
            }

            grid.classList.remove('hidden');
            noResults.classList.add('hidden');

            grid.innerHTML = filteredRecipes.map(recipe => createRecipeCard(recipe)).join('');
        }

        // Create recipe card HTML
        function createRecipeCard(recipe) {
            const confidenceColor = recipe.confidence_score > 0.8 ? 'text-green-600' :
                                   recipe.confidence_score > 0.6 ? 'text-yellow-600' : 'text-red-600';

            return `
                <div class="recipe-card bg-white rounded-lg shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden">
                    <div class="p-6">
                        <!-- Header -->
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 line-clamp-2">${recipe.title}</h3>
                            <span class="${confidenceColor} text-sm font-medium">${Math.round(recipe.confidence_score * 100)}%</span>
                        </div>

                        <!-- Quick Info -->
                        <div class="grid grid-cols-2 gap-2 mb-4 text-sm text-gray-600">
                            ${recipe.cuisine_type ? `<div>üåç ${recipe.cuisine_type}</div>` : ''}
                            ${recipe.difficulty ? `<div>‚≠ê ${recipe.difficulty}</div>` : ''}
                            ${recipe.total_time && recipe.total_time !== 'null' ? `<div>üïí ${recipe.total_time}</div>` : ''}
                            ${recipe.cooking_method?.length ? `<div>üî• ${recipe.cooking_method[0].replace(/_/g, ' ')}</div>` : ''}
                        </div>

                        <!-- Tags -->
                        <div class="space-y-2">
                            ${recipe.proteins?.length ? `
                                <div>
                                    ${recipe.proteins.map(p => `<span class="tag tag-protein">${p}</span>`).join('')}
                                </div>
                            ` : ''}

                            ${recipe.vegetables?.slice(0, 5).length ? `
                                <div>
                                    ${recipe.vegetables.slice(0, 5).map(v => `<span class="tag tag-vegetable">${v}</span>`).join('')}
                                    ${recipe.vegetables.length > 5 ? `<span class="tag tag-vegetable">+${recipe.vegetables.length - 5}</span>` : ''}
                                </div>
                            ` : ''}

                            ${recipe.occasion_tags?.length ? `
                                <div>
                                    ${recipe.occasion_tags.slice(0, 3).map(o => `<span class="tag tag-occasion">${o}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>

                        <!-- Footer -->
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <button onclick="openRecipe('${recipe.post_id}')"
                                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                View Recipe
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Update stats
        function updateStats() {
            document.getElementById('total-recipes').textContent = recipes.length;
            document.getElementById('showing-recipes').textContent = filteredRecipes.length;

            const allIngredients = new Set();
            recipes.forEach(recipe => {
                if (recipe.vegetables) recipe.vegetables.forEach(v => allIngredients.add(v));
                if (recipe.key_ingredients) recipe.key_ingredients.forEach(k => allIngredients.add(k));
            });
            document.getElementById('unique-ingredients').textContent = allIngredients.size;

            const avgConfidence = recipes.reduce((sum, r) => sum + (r.confidence_score || 0), 0) / recipes.length;
            document.getElementById('avg-confidence').textContent = Math.round(avgConfidence * 100) + '%';
        }

        // Update active filters display
        function updateActiveFiltersDisplay() {
            const container = document.getElementById('active-filters');
            const tagsContainer = document.getElementById('active-filter-tags');

            if (activeFilters.size === 0) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            tagsContainer.innerHTML = Array.from(activeFilters).map(filterKey => {
                const [type, value] = filterKey.split(':');
                return `<span class="tag tag-difficulty">${value.replace(/_/g, ' ')} ‚úï</span>`;
            }).join('');
        }

        // Open recipe details (you can implement this)
        function openRecipe(postId) {
            const recipe = recipes.find(r => r.post_id == postId);
            alert(`Recipe: ${recipe.title}\n\nThis would open the full recipe details!`);
            // You could implement a modal or navigate to Instagram post
        }

        // Clear all filters
        function clearFilters() {
            activeFilters.clear();
            document.querySelectorAll('.filter-active').forEach(btn => {
                btn.classList.remove('filter-active');
            });
            document.getElementById('search-input').value = '';
            applyFilters();
            updateActiveFiltersDisplay();
        }

        // Show error state
        function showError() {
            document.getElementById('loading').innerHTML = `
                <div class="text-6xl mb-4">üòµ</div>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Oops! Couldn't load recipes</h3>
                <p class="text-gray-600">Make sure your analyzed_recipes.json file is in the same directory</p>
            `;
        }

        // Event listeners
        document.getElementById('search-input').addEventListener('input', applyFilters);
        document.getElementById('clear-filters').addEventListener('click', clearFilters);

        // Initialize the app
        init();
    </script>
</body>
</html>
