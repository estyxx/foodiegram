<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Cookstagram Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-container {
            animation: fadeIn 0.6s ease-out;
        }

        .password-input {
            transition: all 0.3s ease;
        }

        .password-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen flex items-center justify-center p-4">
    <div class="login-container bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="text-6xl mb-4">üç≥</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Cookstagram</h1>
            <p class="text-gray-600">Enter password to access your recipe collection</p>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="space-y-6">
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                    Password
                </label>
                <div class="relative">
                    <input type="password"
                           id="password"
                           name="password"
                           class="password-input w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                           placeholder="Enter your password"
                           required
                           autocomplete="current-password">
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                        <button type="button"
                                id="toggle-password"
                                class="text-gray-400 hover:text-gray-600 focus:outline-none">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden error-message bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                <div class="flex items-center">
                    <span class="text-red-500 mr-2">‚ö†Ô∏è</span>
                    <span id="error-text">Invalid password. Please try again.</span>
                </div>
            </div>

            <!-- Login Button -->
            <button type="submit"
                    class="login-btn w-full text-white py-3 px-4 rounded-lg font-semibold text-lg">
                üîì Access Recipes
            </button>
        </form>

        <!-- Footer -->
        <div class="mt-8 text-center text-sm text-gray-500">
            <p>Your recipe collection is password protected</p>
        </div>
    </div>

    <script>
        class LoginManager {
            constructor() {
                this.setupEventListeners();
                this.checkExistingAuth();
            }

            setupEventListeners() {
                const form = document.getElementById('login-form');
                const passwordInput = document.getElementById('password');
                const toggleBtn = document.getElementById('toggle-password');

                form.addEventListener('submit', (e) => this.handleLogin(e));
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.handleLogin(e);
                    }
                });

                toggleBtn.addEventListener('click', () => this.togglePasswordVisibility());
            }

            checkExistingAuth() {
                // Check if user is already authenticated
                const isAuthenticated = localStorage.getItem('cookstagram_authenticated');
                const authExpiry = localStorage.getItem('cookstagram_auth_expiry');

                if (isAuthenticated && authExpiry && new Date().getTime() < parseInt(authExpiry)) {
                    // User is already authenticated and session hasn't expired
                    this.redirectToApp();
                }
            }

            async handleLogin(event) {
                event.preventDefault();

                const password = document.getElementById('password').value;
                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');

                // Hide any previous error
                errorDiv.classList.add('hidden');

                if (!password) {
                    this.showError('Please enter a password');
                    return;
                }

                try {
                    // Show loading state
                    const submitBtn = event.target.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'üîê Checking...';
                    submitBtn.disabled = true;

                    // Verify password with backend
                    const isValid = await this.verifyPassword(password);

                    if (isValid) {
                        // Store authentication state
                        const expiryTime = new Date().getTime() + (24 * 60 * 60 * 1000); // 24 hours
                        localStorage.setItem('cookstagram_authenticated', 'true');
                        localStorage.setItem('cookstagram_auth_expiry', expiryTime.toString());
                        localStorage.setItem('cookstagram_password', password); // Store password for API calls

                        // Redirect to main app
                        this.redirectToApp();
                    } else {
                        this.showError('Invalid password. Please try again.');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    this.showError('Login failed. Please try again.');
                } finally {
                    // Reset button state
                    const submitBtn = event.target.querySelector('button[type="submit"]');
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            }

            async verifyPassword(password) {
                try {
                    // Try to verify with backend first
                    const response = await fetch('https://cookstagram-data.vercel.app/api/auth', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ password: password })
                    });

                    if (response.ok) {
                        return true;
                    }
                } catch (error) {
                    console.log('Backend auth not available, using fallback');
                }
            }

            showError(message) {
                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');

                errorText.textContent = message;
                errorDiv.classList.remove('hidden');

                // Focus back on password input
                document.getElementById('password').focus();
                document.getElementById('password').select();
            }

            togglePasswordVisibility() {
                const passwordInput = document.getElementById('password');
                const toggleBtn = document.getElementById('toggle-password');

                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleBtn.textContent = 'üôà';
                } else {
                    passwordInput.type = 'password';
                    toggleBtn.textContent = 'üëÅÔ∏è';
                }
            }

            redirectToApp() {
                // Add a small delay for better UX
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 500);
            }
        }

        // Initialize login manager when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new LoginManager();
        });
    </script>
</body>
</html>
